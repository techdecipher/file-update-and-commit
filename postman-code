// Add ARN to first array after "name = ["
function addArnToFirstArrayAfterAnchor(fullText, anchorRegex, arn, indentSpaces = 8){
  const anchorMatch = fullText.match(anchorRegex);
  if (!anchorMatch) return fullText;

  const anchorIdx   = fullText.indexOf(anchorMatch[0]);
  const afterAnchor = fullText.slice(anchorIdx);
  const openIdx     = afterAnchor.indexOf('[');
  if (openIdx < 0) return fullText;

  const start = anchorIdx + openIdx + 1;
  const end   = fullText.indexOf(']', start);
  if (end < 0) return fullText;

  const inside = fullText.slice(start, end);
  if (inside.includes(`"${arn}"`)) return fullText; // already present

  const indent     = ' '.repeat(indentSpaces);
  const needsComma = inside.trim().length > 0 && !inside.trim().endsWith(',');
  
  // Ensure the closing bracket ] is on its own line after we insert
  const insertion = `${inside}${needsComma ? ',' : ''}\n${indent}"${arn}"\n`;

  return fullText.slice(0, start) + insertion + fullText.slice(end);
}
